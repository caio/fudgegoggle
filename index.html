<!DOCTYPE html>
<html lang="en">
<head>
    <title>FudgeGoggle</title>
    <meta charset="UTF-8" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’©</text></svg>">
</head>
<body>
<h1>FudgeGoggle</h1>

<video autoplay></video>
<canvas hidden></canvas>

<script type="module">
import init, {muh_len} from './pkg/fudgegoggle.js';
await init();

function decode() {
    var video = document.querySelector("video");
    var width = video.videoWidth;
    var height = video.videoHeight;

    // Can I avoid this dance somehow?
    var context = document.querySelector("canvas").getContext("2d");
    context.drawImage(video, width, height);
    let imageData = context.getImageData(0, 0, width, height);

    let counted = muh_len(imageData.data);
    console.log(`wasm::muh_len(canvas) = ${counted}`);
}

var decodeIntervalId;

navigator.mediaDevices.getUserMedia({video: true})
    .then(stream => {
        document.querySelector("video").srcObject = stream;
        decodeIntervalId = setInterval(decode, 300);
    })
    .catch(console.error);


</script>
</body>
</html>
